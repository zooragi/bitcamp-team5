<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ThemeMapper">
  
  <resultMap type="Theme" id="ThemeMap">
    <id column="theme_no" property="no"/> 
    <result column="title" property="title"/>
    <result column="public" property="public"/>
    <result column="created_dt" property="registeredDate"/>
    
    <association property="owner" javaType="User">
  	  <id column="user_no" property="no"/> 
	    <result column="nickname" property="nickname"/>
	    <result column="email" property="email"/>
    </association>
    
    <association property="category" javaType="Category">
	    <id column="category_no" property="no"/>
	    <result column="c_name" property="name"/>
    </association>
     
    <collection property="hashtags" ofType="String">
	    <result column="h_name" property="name"/>
    </collection>
  </resultMap>
  
  <resultMap type="Category" id="CategoryMap">
    <id column="category_no" property="no"/>
	  <result column="c_name" property="name"/>
  </resultMap>
  
  <select id="findByUserNo" resultMap="ThemeMap" parameterType="int">
  	select 
  		t.theme_no, 
  		user_no, 
  		title, 
  		public, 
  		c.name c_name,
  		h.name h_name
  	from
  		jeju_theme t
 			left outer join jeju_theme_hashtag h on t.theme_no=h.theme_no
 			join jeju_theme_category c on c.category_no=t.category_no
  	where 
  		user_no=#{no}
  </select>
  
  <select id="findAllCategory" resultMap="CategoryMap">
  	select
  		category_no,
  		name
  	from 
  		jeju_theme_category
  </select>
  
	<insert id="insert" parameterType="theme"
		useGeneratedKeys="true" keyColumn="theme_no" keyProperty="no">
		Insert into jeju_theme(user_no,title,public,category_no)
		values(#{owner.no},#{title},#{public},#{category.no})
	</insert>
	
	<insert id="insertHashtags" parameterType="map">
		insert into jeju_theme_hashtag(theme_no, name)
		values(#{themeNo},#{name})
	</insert>

</mapper>







